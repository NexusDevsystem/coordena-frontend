<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <title>Painel de Administração</title>

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />

  <!-- Seu CSS personalizado -->
  <link rel="stylesheet" href="/assets/css/admin.css" />
</head>

<body class="bg-gray-100">
  <!-- Proteção de rota (apenas admin) -->
  <script>
    const storedAdminUser = localStorage.getItem('admin_user');
    const storedAdminToken = localStorage.getItem('admin_token');
    if (!storedAdminUser || !storedAdminToken) {
      alert('Sessão do Admin expirada. Faça login novamente.');
      window.location.replace('/login.html');
    } else {
      try {
        const userObj = JSON.parse(storedAdminUser);
        if (userObj.role !== 'admin') {
          window.location.replace('/');
        }
      } catch {
        localStorage.removeItem('admin_user');
        localStorage.removeItem('admin_token');
        window.location.replace('/login.html');
      }
    }

    const BASE_API = window.location.hostname.includes('localhost')
      ? 'http://localhost:10000'
      : 'https://coordena-backend.onrender.com';
  </script>

  <div class="container py-5">
    <!-- Início do cabeçalho em azul -->
    <div class="bg-primary text-white rounded-3 p-4 mb-4 d-flex justify-content-between align-items-center">
      <div>
        <h1 class="h3 mb-0"><i class="fas fa-user-shield me-2"></i>Painel de Administração</h1>
        <p class="mb-0">Gerencie solicitações de usuários e reservas</p>
      </div>
      <!-- Botão de Logout -->
      <button id="admin-logout-btn" class="btn btn-outline-light">
        <i class="fas fa-sign-out-alt me-1"></i> Logout
      </button>
    </div>
    <!-- Fim do cabeçalho em azul -->

    <!-- Nav‐tabs: Usuários Pendentes / Reservas Pendentes / Reservas Ativas -->
    <ul class="nav nav-tabs mb-3" id="adminTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="usuarios-tab" data-bs-toggle="tab" data-bs-target="#usuarios" type="button"
          role="tab" aria-controls="usuarios" aria-selected="true">
          <i class="fas fa-user"></i> Usuários Pendentes
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="reservas-tab" data-bs-toggle="tab" data-bs-target="#reservas" type="button"
          role="tab" aria-controls="reservas" aria-selected="false">
          <i class="fas fa-calendar-alt"></i> Reservas Pendentes
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="ativas-tab" data-bs-toggle="tab" data-bs-target="#ativas" type="button"
          role="tab" aria-controls="ativas" aria-selected="false">
          <i class="fas fa-check-circle"></i> Reservas Ativas
        </button>
      </li>
    </ul>

    <div class="tab-content" id="adminTabContent">
      <!-- ABA 1: Usuários Pendentes -->
      <div class="tab-pane fade show active" id="usuarios" role="tabpanel" aria-labelledby="usuarios-tab">
        <div class="row mb-3">
          <div class="col-md-8">
            <div class="search-box position-relative">
              <input type="text" id="busca-usuarios" class="form-control ps-4"
                placeholder="Buscar usuário por nome ou email..." />
              <i class="fas fa-search position-absolute"
                style="top:50%; right:15px; transform: translateY(-50%); color:#6c757d;"></i>
            </div>
          </div>
          <div class="col-md-4">
            <select id="ordenacao-usuarios" class="form-select">
              <option value="createdAt">Ordem de Chegada</option>
              <option value="name">Nome (A-Z)</option>
              <option value="email">Email (A-Z)</option>
            </select>
          </div>
        </div>
        <div id="lista-pendentes-usuarios"></div>
      </div>

      <!-- ABA 2: Reservas Pendentes -->
      <div class="tab-pane fade" id="reservas" role="tabpanel" aria-labelledby="reservas-tab">
        <div class="row mb-3">
          <div class="col-md-8">
            <div class="search-box position-relative">
              <input type="text" id="busca-reservas" class="form-control ps-4"
                placeholder="Buscar reserva por lab ou requisitante..." />
              <i class="fas fa-search position-absolute"
                style="top:50%; right:15px; transform: translateY(-50%); color:#6c757d;"></i>
            </div>
          </div>
          <div class="col-md-4">
            <input type="date" id="filtro-data-reservas" class="form-control mb-2" placeholder="Data" />
            <select id="ordenacao-reservas" class="form-select">
              <option value="date">Data</option>
              <option value="responsible">Requisitante (A-Z)</option>
            </select>
          </div>
        </div>
        <div id="lista-pendentes-reservas"></div>
      </div>

      <!-- ABA 3: Reservas Ativas -->
      <div class="tab-pane fade" id="ativas" role="tabpanel" aria-labelledby="ativas-tab">
        <div class="row mb-3">
          <div class="col-md-8">
            <div class="search-box position-relative">
              <input type="text" id="busca-ativas" class="form-control ps-4"
                placeholder="Buscar lab ou requisitante nas aprovadas..." />
              <i class="fas fa-search position-absolute"
                style="top:50%; right:15px; transform: translateY(-50%); color:#6c757d;"></i>
            </div>
          </div>
          <div class="col-md-4">
            <input type="date" id="filtro-data-ativas" class="form-control mb-2" placeholder="Data" />
          </div>
        </div>
        <div id="lista-ativas" class="row g-3"></div>
      </div>
    </div>
  </div>

  <!-- Toast de notificação (canto inferior direito) -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1050;">
    <div id="toastNovoCadastro" class="toast align-items-center text-white bg-dark border-0" role="alert"
      aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body" id="meuToastBody"></div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
          aria-label="Fechar"></button>
      </div>
    </div>
  </div>

  <!-- Bootstrap Bundle JS (inclui Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Seu JS consolidado (main.js) -->
  <script src="../assets/js/main.js"></script>
</body>
</html>
