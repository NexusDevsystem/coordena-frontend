<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <!-- 1) Meta viewport para deixar a página responsiva -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Painel de Administração</title>

  <!-- 2) Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />

  <!-- 3) Seu CSS personalizado (opcionalmente você pode adicionar regras extras para mobile) -->
  <link rel="stylesheet" href="/assets/css/admin.css" />
</head>

<body class="bg-gray-100">
  <!-- Proteção de rota (apenas admin) -->
  <script>
    const storedAdminUser = localStorage.getItem('admin_user');
    const storedAdminToken = localStorage.getItem('admin_token');
    if (!storedAdminUser || !storedAdminToken) {
      alert('Sessão do Admin expirada. Faça login novamente.');
      window.location.replace('/login.html');
    } else {
      try {
        const userObj = JSON.parse(storedAdminUser);
        if (userObj.role !== 'admin') {
          window.location.replace('/');
        }
      } catch {
        localStorage.removeItem('admin_user');
        localStorage.removeItem('admin_token');
        window.location.replace('/login.html');
      }
    }

    const BASE_API = window.location.hostname.includes('localhost')
      ? 'http://localhost:10000'
      : 'https://coordena-backend.onrender.com';
  </script>

  <!-- Container-fluid para ocupar toda a largura em telas pequenas -->
  <div class="container-fluid py-4 px-2 px-md-4">
    <!-- ======= Cabeçalho Azul Responsivo ======= -->
    <div
      class="bg-primary text-white rounded-3 p-3 p-md-4 mb-4 d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3"
    >
      <div class="w-100 w-md-auto">
        <h1 class="h4 mb-1"><i class="fas fa-user-shield me-2"></i>Painel de Administração</h1>
        <p class="mb-0 small">Gerencie solicitações de usuários e reservas</p>
      </div>

      <!-- Botão Logout -->
      <button id="admin-logout-btn" class="btn btn-outline-light me-2">
        <i class="fas fa-sign-out-alt me-1"></i> Logout
      </button>

      <!-- NOVO: Botão “Ativar Notificações” -->
      <button id="btn-ativar-notificacoes" class="btn btn-outline-light">
        <i class="fas fa-bell"></i> Ativar Notificações
      </button>
    </div>
    <!-- ========================================= -->

    <!-- Nav‐tabs: Usuários Pendentes / Reservas Pendentes / Reservas Ativas -->
    <!-- Em telas estreitas, esse <ul> ficará rolável horizontalmente -->
    <div class="overflow-auto mb-3">
      <ul class="nav nav-tabs flex-nowrap" id="adminTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button
            class="nav-link active"
            id="usuarios-tab"
            data-bs-toggle="tab"
            data-bs-target="#usuarios"
            type="button"
            role="tab"
            aria-controls="usuarios"
            aria-selected="true"
          >
            <i class="fas fa-user"></i> Usuários Pendentes
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="reservas-tab"
            data-bs-toggle="tab"
            data-bs-target="#reservas"
            type="button"
            role="tab"
            aria-controls="reservas"
            aria-selected="false"
          >
            <i class="fas fa-calendar-alt"></i> Reservas Pendentes
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="ativas-tab"
            data-bs-toggle="tab"
            data-bs-target="#ativas"
            type="button"
            role="tab"
            aria-controls="ativas"
            aria-selected="false"
          >
            <i class="fas fa-check-circle"></i> Reservas Ativas
          </button>
        </li>
      </ul>
    </div>

    <div class="tab-content" id="adminTabContent">
      <!-- ================== ABA 1: Usuários Pendentes ================== -->
      <div class="tab-pane fade show active" id="usuarios" role="tabpanel" aria-labelledby="usuarios-tab">
        <div class="row mb-3 gx-2">
          <!-- Campo de busca ocupa toda a largura em mobile (col-12), depois col-md-8 -->
          <div class="col-12 col-md-8">
            <div class="search-box position-relative">
              <input
                type="text"
                id="busca-usuarios"
                class="form-control ps-4 w-100"
                placeholder="Buscar usuário por nome ou email..."
              />
              <i
                class="fas fa-search position-absolute"
                style="top:50%; right:15px; transform: translateY(-50%); color:#6c757d;"
              ></i>
            </div>
          </div>
          <!-- Filtro de ordenação ocupa col-12 em mobile, depois col-md-4 -->
          <div class="col-12 col-md-4">
            <select id="ordenacao-usuarios" class="form-select w-100">
              <option value="createdAt">Ordem de Chegada</option>
              <option value="name">Nome (A-Z)</option>
              <option value="email">Email (A-Z)</option>
            </select>
          </div>
        </div>
        <div id="lista-pendentes-usuarios"></div>
      </div>

      <!-- =============== ABA 2: Reservas Pendentes ================= -->
      <div class="tab-pane fade" id="reservas" role="tabpanel" aria-labelledby="reservas-tab">
        <div class="row mb-3 gx-2">
          <!-- Campo de busca ocupa col-12 em mobile, depois col-md-8 -->
          <div class="col-12 col-md-8">
            <div class="search-box position-relative">
              <input
                type="text"
                id="busca-reservas"
                class="form-control ps-4 w-100"
                placeholder="Buscar reserva por lab ou requisitante..."
              />
              <i
                class="fas fa-search position-absolute"
                style="top:50%; right:15px; transform: translateY(-50%); color:#6c757d;"
              ></i>
            </div>
          </div>
          <!-- Filtros de data + ordenação ocupa col-12 em mobile, depois col-md-4 -->
          <div class="col-12 col-md-4">
            <input
              type="date"
              id="filtro-data-reservas"
              class="form-control mb-2 w-100"
              placeholder="Data"
            />
            <select id="ordenacao-reservas" class="form-select w-100">
              <option value="date">Data</option>
              <option value="responsible">Requisitante (A-Z)</option>
            </select>
          </div>
        </div>
        <div id="lista-pendentes-reservas"></div>
      </div>

      <!-- ================ ABA 3: Reservas Ativas ==================== -->
      <div class="tab-pane fade" id="ativas" role="tabpanel" aria-labelledby="ativas-tab">
        <div class="row mb-3 gx-2">
          <!-- Campo de busca mobile: col-12, depois col-md-8 -->
          <div class="col-12 col-md-8">
            <div class="search-box position-relative">
              <input
                type="text"
                id="busca-ativas"
                class="form-control ps-4 w-100"
                placeholder="Buscar lab ou requisitante nas aprovadas..."
              />
              <i
                class="fas fa-search position-absolute"
                style="top:50%; right:15px; transform: translateY(-50%); color:#6c757d;"
              ></i>
            </div>
          </div>
          <!-- Filtro de data mobile: col-12, depois col-md-4 -->
          <div class="col-12 col-md-4">
            <input
              type="date"
              id="filtro-data-ativas"
              class="form-control mb-2 w-100"
              placeholder="Data"
            />
          </div>
        </div>
        <!-- Lista de cards para as Reservas Ativas -->
        <div id="lista-ativas" class="row g-3"></div>
      </div>
    </div>
  </div>

  <!-- Toast de notificação (canto inferior direito) -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1050;">
    <div
      id="toastNovoCadastro"
      class="toast align-items-center text-white bg-dark border-0"
      role="alert"
      aria-live="assertive"
      aria-atomic="true"
    >
      <div class="d-flex">
        <div class="toast-body" id="meuToastBody"></div>
        <button
          type="button"
          class="btn-close btn-close-white me-2 m-auto"
          data-bs-dismiss="toast"
          aria-label="Fechar"
        ></button>
      </div>
    </div>
  </div>

  <!-- Bootstrap Bundle JS (inclui Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Seu JS principal (contém toda a lógica de calendário + notificações) -->
  <script src="/assets/js/main.js"></script>
</body>
</html>
